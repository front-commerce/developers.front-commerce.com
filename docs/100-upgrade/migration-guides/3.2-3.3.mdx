---
title: 3.2 -> 3.3
description:
  This page lists the highlights for upgrading a project from Front-Commerce 3.2
  to 3.3.
---

<p>{frontMatter.description}</p>

## Update dependencies

Update all your `@front-commerce/*` dependencies to this version:

```shell
pnpm update "@front-commerce/\*@3.3.0"
```

## Automated Migration

```shell
pnpm run front-commerce migrate --transform 3.3.0
```

## Code changes

### Remix entrypoints

In this release, we improved features that required to hook into your Remix
application files created with the initial skeleton.<br /> You must update these
files in your application, as detailed below **or copy the ones from the latest
skeleton**.

<details>
  <summary><code>entry.server.ts</code> file</summary>

```diff
diff --git a/skeleton/app/entry.server.tsx b/skeleton/app/entry.server.tsx
index 297a34fa2..8012fda4c 100644
--- a/skeleton/app/entry.server.tsx
+++ b/skeleton/app/entry.server.tsx
@@ -89,10 +89,10 @@ function handleBotRequest(
             headers: responseHeaders,
             status: responseStatusCode,
           });
-          transformBotResponse(response, loadContext.frontCommerce);
-          resolve(response);
-
-          pipe(body);
+          transformBotResponse(response, loadContext.frontCommerce).then(() => {
+            resolve(response);
+            pipe(body);
+          });
         },
         onShellError(error: unknown) {
           reject(error);
@@ -143,10 +143,12 @@ function handleBrowserRequest(
             headers: responseHeaders,
             status: responseStatusCode,
           });
-          transformBrowserResponse(response, loadContext.frontCommerce);
-          resolve(response);
-
-          pipe(body);
+          transformBrowserResponse(response, loadContext.frontCommerce).then(
+            () => {
+              resolve(response);
+              pipe(body);
+            }
+          );
         },
         onShellError(error: unknown) {
           reject(error);
@@ -162,10 +164,10 @@ function handleBrowserRequest(
   });
 }

-export function handleDataRequest(
+export async function handleDataRequest(
   response: Response,
   { context }: DataFunctionArgs
 ) {
-  transformDataResponse(response, context.frontCommerce);
+  await transformDataResponse(response, context.frontCommerce);
   return response;
 }
```

</details>

<details>
  <summary><code>root.tsx</code> file</summary>

```diff
diff --git a/skeleton/app/root.tsx b/skeleton/app/root.tsx
index a28dcf87e..68e788d96 100644
--- a/skeleton/app/root.tsx
+++ b/skeleton/app/root.tsx
@@ -21,30 +21,15 @@ import {
 import { usePageProgress } from "theme/components/helpers/usePageProgress";
 import "theme/main.css";
 import config from "~/config/website";
-import { AppQueryDocument } from "~/graphql/graphql";
 import { LiveReload, useSWEffect } from "@remix-pwa/sw";
 import manifest from "~/manifest";

 export const loader = async ({ context }: LoaderFunctionArgs) => {
   const app = new FrontCommerceApp(context.frontCommerce);

-  const response = await app.graphql.query(AppQueryDocument);
-
-  if (!response.shop) {
-    throw new Response("", { status: 500, statusText: "Shop not found" });
-  }
-
   return json({
-    shop: response.shop,
     device: app.config.device,
-    process: {
-      env: {
-        NODE_ENV: process.env.NODE_ENV,
-        SERVER: false,
-        FRONT_COMMERCE_WEB_DEV_ANALYTICS_WARNING_DISABLE:
-          process.env.FRONT_COMMERCE_WEB_DEV_ANALYTICS_WARNING_DISABLE,
-      },
-    },
+    publicConfig: app.config.public,
   });
 };
```

</details>

### Automatic session cookie headers

In this release, we added a feature that will automatically set the `Set-Cookie`
header for the session cookie when the user session needs to be commited.

<details>

<summary>
  <code>app/routes/my-route.ts</code> file
</summary>

```diff title="app/routes/my-route.ts"
import { FrontCommerceApp } from "@front-commerce/remix";
import { json } from "@front-commerce/remix/node";
import { MyQuery } from "~/graphql/graphql";

const loader = async ({ context, request }) => {
    const app = new FrontCommerceApp(context.frontCommerce);

    const data = app.query(MyQuery);
-    return json(data, {
-        headers: {
-            "Set-Cookie": await app.user.session.commit(),
-        },
-    });
+    return json(data);
}
```

</details>

:::caution

Due to how the requests are handled by the current version of Remix, this will
only work when creating response with `json()` without passing a second
parameter.

:::

### Deprecate `process.env.FRONT_COMMERCE_WEB_*` usage

**Breaking:** In this release, we updated the way we handle public
configuration.

To cope with these changes, you will need to ensure that you replace any of
these usages with the new `publicConfig` values. We introduced a `3.3.0` codemod
to automatically update your codebase, follow the
[Automated Migration](#automated-migration) to run the codemod.

Before:

```js
const {
  FRONT_COMMERCE_WEB_DEV_ANALYTICS_WARNING_DISABLE,
  FRONT_COMMERCE_WEB_DEV_DISABLE_PASSWORD_HINT,
} = process.env;

const example = {
  analyticsWarningDisable: FRONT_COMMERCE_WEB_DEV_ANALYTICS_WARNING_DISABLE,
  disablePasswordHint: FRONT_COMMERCE_WEB_DEV_DISABLE_PASSWORD_HINT,
  myCustomValue: process.env.FRONT_COMMERCE_WEB_MY_CUSTOM_VALUE,
};
```

After:

```js
import { getPublicConfig } from "@front-commerce/core/react";

// After running your application for the first time,
// you should have all typed values in the public config
const publicConfig = getPublicConfig();

const example = {
  analyticsWarningDisable: publicConfig?.analytics?.disableDevWarning ?? false,
  disablePasswordHint: publicConfig?.password?.disablePasswordHint ?? false,
  myCustomValue: getPublicConfig("FRONT_COMMERCE_WEB_MY_CUSTOM_VALUE"), // This will warn with a deprecation message
};
```

:::caution

We highly suggest that you move any of your custom values to a new config
provider which extends the `public` schema.

See
[Public configurations documentation](/docs/3.x/guides/configuration/public-configuration)
for more details.

:::

### Deprecate `getCurrentShopConfig` usage

In this version we have deprecated the usages of `getCurrentShopConfig` in favor
`config.shop`, the function has been moved to
`@front-commerce/compat/shop/getShopConfig` for compatibility reasons, but we
suggest you to use `config.shop` instead.

```ts
// from a loader
export const loader = async ({ context }) => {
  const app = new FrontCommerceApp(context.frontCommerce);
  // add-next-line
  const currentShopConfig = app.config.shop;
  // ...
};

// from an action
export const action = async ({ context }) => {
  const app = new FrontCommerceApp(context.frontCommerce);
  // add-next-line
  const currentShopConfig = app.config.shop;
  // ...
};

// from a graphql resolver
export default {
  Query: {
    myQuery: async (parent, args, context, info) => {
      // add-next-line
      const currentShopConfig = context.config.shop;
      // ...
    },
  },
};
```
