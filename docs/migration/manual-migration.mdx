---
sidebar_position: 3
title: Manual Migration
description:
  This manual migration process should be run after the automated migration
  process, to complete the missing parts, or debug issues in the migration CLI
  output.
---

This manual migration process should be run after the
[automated migration process](./automated-migration), to complete the missing
parts, or debug issues in the migration CLI output.

## `makeCommandDispatcherWithCommandFeedback` API change

[`makeCommandDispatcherWithCommandFeedback` API has
changed](https://gitlab.blackswift.cloud/front-commerce/front-commerce/-/commit/2cc5515682349ca0f1b1aba922a277db27ad067c?merge_request_iid=2200).
In version 2, the second parameter of `makeCommandDispatcherWithCommandFeedback` was an
optional boolean (default `true`) and if this parameter was evaluated to a
truthy value, the resulting component had the responsibility of displaying the
result of the command with the `InlineAlert` component. In version 3,
`makeCommandDispatcherWithCommandFeedback` now expects an optional React
component to display the result of the command.

To cope with this change, you need to review all components using
`makeCommandDispatcherWithCommandFeedback`:

* if `makeCommandDispatcherWithCommandFeedback` is called with a falsy second
  parameter, you don't have to change anything
* if `makeCommandDispatcherWithCommandFeedback` is called with a truthy second
  parameter or without the second parameter, you have to adapt your code. To
  have exactly the same behavior as before, the new call should look like:
  ```jsx
  makeCommandDispatcherWithCommandFeedback({ /* commands definition */ }, ({ success, message }) => {
    return <InlineAlert appearance={success ? "success" : "error"}>{message}</InlineAlert>;
  })
  ```

## Sass Migration

In the latest version of Front-Commerce we converted all global Sass variables to CSS
variables during the [automated migration](./automated-migration). This allows
for a more modular approach to theming and a better developer experience.
However, there are still some manual steps that need to be taken to complete the
migration.

### Media Mixin

If you make use of the
[`media-breakpoint-up`](https://gitlab.blackswift.cloud/front-commerce/front-commerce/-/blob/01f9c95003f7d4204acd12264c3375464e6c3a12/theme-chocolatine/web/theme/components/atoms/Breakpoints/_breakpoints.scss#L23-34)
mixin, you will need to directly import the
[\_breakpoints.scss](https://gitlab.blackswift.cloud/front-commerce/front-commerce/-/blob/01f9c95003f7d4204acd12264c3375464e6c3a12/theme-chocolatine/web/theme/components/atoms/Breakpoints/_breakpoints.scss)
file at the location where it is used.

If you have the following example component:

```scss title="theme/components/atoms/Example/Example.scss"
@include media-breakpoint-up(md) {
  .Example {
    color: red;
  }
}
```

You would need to import the `_breakpoints.scss` directly in the `Example.scss`
file

```scss title="theme/components/atoms/Example/Example.scss"
// add-next-line
@import "theme/components/atoms/Breakpoints/breakpoints";

@include media-breakpoint-up(md) {
  .Example {
    color: red;
  }
}
```

### Color functions

If you use any Sass
[color functions](https://sass-lang.com/documentation/modules/color) you will
need to directly import the
[color.scss](https://gitlab.blackswift.cloud/front-commerce/front-commerce/-/blob/01f9c95003f7d4204acd12264c3375464e6c3a12/theme-chocolatine/web/theme/components/atoms/Colors/_colors.scss)
file at the location where it is used. This is because Sass can not process the
functions on CSS variables.

If you have the following example component:

```scss title="theme/components/atoms/Example/Example.scss"
.Example {
  color: darken(var(--colorPrimary), 10%);
}
```

You would need to import the `color.scss` directly in the `Example.scss` file

```scss title="theme/components/atoms/Example/Example.scss"
// add-next-line
@import "theme/components/atoms/Colors/colors";

.Example {
  // remove-next-line
  color: darken(var(--colorPrimary), 10%);
  // add-next-line
  color: darken($colorPrimary, 10%);
}
```

### Calculations

The automated migration step takes care of changing SASS global variables to
[CSS custom
properties](https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties)
and of transforming declarations value with a unique multiplication and [the
usage of `math.div`](https://sass-lang.com/documentation/modules/math/#div) so
that it becomes a valid CSS declaration:

```scss title="theme/components/atoms/Example/Example.scss"
.example {
  // remove-next-line
  padding: $boxSizeMargin;
  // add-next-line
  padding: var(--boxSizeMagin);
  // remove-next-line
  margin-top: $boxSizeMargin * 2;
  // add-next-line
  margin-top: calc(var(--boxSizeMagin) * 2);
  // remove-next-line
  margin-bottom: math.div($boxSizeMargin, 4);
  // add-next-line
  margin-bottom: calc(var(--boxSizeMargin) / 4);
}
```

However for more complex calculations or for declarations with several values,
only the usage of the SASS variable will be updated. After this step, a manual
fix is needed. When starting Front-Commerce, `sass` is executed and it will
report any invalid expressions. Here is a list of common pattern to fix:

```scss title="theme/components/atoms/Example/Example.scss"
.example {
  // remove-next-line
  padding: var(--boxSizeMargin) * 2 var(--boxSizeMargin) * 4 var(--boxSizeMargin) * 2 0;
  // add-next-line
  padding: calc(var(--boxSizeMargin) * 2) calc(var(--boxSizeMargin) * 4) calc(var(--boxSizeMargin) * 2) 0;
  // remove-next-line
  max-width: calc(#{var(--boxSizeMargin) * 24} + 50ch);
  // add-next-line
  max-width: calc(var(--boxSizeMargin) * 24 + 50ch);
  // remove-next-line
  margin: calc(-var(--boxSizeMargin) / 4) * 3;
  // add-next-line
  margin: calc(-var(--boxSizeMargin) * 3 / 4);
```

### `@extend` handling

If `@extend` is used with a selector defined in another stylesheet, you need to
manually import that stylesheet. For example, `sass` would fail compiling the following stylesheet:

```scss title="theme/components/atoms/Example/Example.scss"
.example {
  @extend .another-selector
}
```

This is happening because `.another-selector` is unknown, so the solution is to
import the stylesheet defining it:


```scss title="theme/components/atoms/Example/Example.scss"
// add-next-line
@import "theme/some/path/defining/another-selector";

.example {
  @extend .another-selector
}
```

## Modal Routes

In V2, a modal state parameter facilitated rendering arbitrary routes in a modal
during routing. In Remix, this is non-trivial unless the target route is a child
route. We have introduced a `ModalLink` component to replace the previous
mechanism. It generates a link that displays a component in a modal upon user
click, with the modal state reflected in the URL hash for sharing and consistent
UI presentation across users.

Here is an example of the required changes:

```jsx title="theme/components/organisms/Header/Header.js"
// add-start
import { ModalLink } from "theme/components/organisms/Modal";
import Login from "theme/components/organisms/Login";
// add-end

export function Header() {
  return (
    <header>
      // remove-next-line
      <Link to={{ pathname: "/whatever", state: { modal: true } }}>Login</Link>
      // add-start
      <ModalLink to="/login" linkContent="Login">
        <Login />
      </ModalLink>
      // add-end
    </header>
  );
}
```

## Environment variables

### Magento

In V2, Magento1 and Magento2 environment variables were prefixed the same way.
`FRONT_COMMERCE_MAGENTO_*`, in V3, we have split them into
`FRONT_COMMERCE_MAGENTO1_*` and `FRONT_COMMERCE_MAGENTO2_*`.

```diff
- FRONT_COMMERCE_MAGENTO_CONSUMER_KEY=token
- FRONT_COMMERCE_MAGENTO_CONSUMER_SECRET=token
- FRONT_COMMERCE_MAGENTO_ACCESS_TOKEN=token
- FRONT_COMMERCE_MAGENTO_ACCESS_TOKEN_SECRET=token

## Magento 1
+ FRONT_COMMERCE_MAGENTO1_CONSUMER_KEY=token
+ FRONT_COMMERCE_MAGENTO1_CONSUMER_SECRET=token
+ FRONT_COMMERCE_MAGENTO1_ACCESS_TOKEN=token
+ FRONT_COMMERCE_MAGENTO1_ACCESS_TOKEN_SECRET=token

## Magento 2
+ FRONT_COMMERCE_MAGENTO2_CONSUMER_KEY=token
+ FRONT_COMMERCE_MAGENTO2_CONSUMER_SECRET=token
+ FRONT_COMMERCE_MAGENTO2_ACCESS_TOKEN=token
+ FRONT_COMMERCE_MAGENTO2_ACCESS_TOKEN_SECRET=token
```
